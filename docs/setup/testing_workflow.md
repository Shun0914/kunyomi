# テスト運用ワークフロー

## 概要

このドキュメントは、E2Eテストの実施と管理に関する運用方法を説明します。
テスト実施中に発見された問題やテストケース自体の問題を、適切にチケット管理するための手順を記載しています。

## 目的

- Week1/Week2で実装された機能に対するE2Eテストの実施
- テスト実施中に発見された不具合の適切な管理
- テストケース自体の問題・改善提案の管理
- 品質保証プロセスの可視化

---

## テスト実施前の準備

### 1. E2Eテストマスターチケットの作成

各Week（Week1、Week2など）ごとに、E2Eテストマスターチケットを作成します。

#### チケット作成手順

1. GitHubでIssueを作成
   - タイトル: `[E2Eテスト] Week1 テスト実施マスター`（Week番号は適宜変更）
   - ラベル: `testing`
   - マイルストーン: **紐付けない**（実装進捗とは独立した品質確認のため）

2. チケット本文に以下を記載
   - 目的: Weekで実装された機能に対するE2Eテストの実施と管理
   - 関連ドキュメント: `docs/testing/e2e_test_cases_week1.md` への参照
   - 運用方針
   - 完了条件

#### テンプレート

```markdown
## 目的
Week1で実装された機能に対するE2Eテストの実施と管理

## スコープ
- Week1で実装されたすべての機能に対するE2Eテスト
- テスト実施中に発見された不具合の管理
- テストケース自体の問題・改善提案の管理

## 関連ドキュメント
- [E2Eテストケース（Week1）](./docs/testing/e2e_test_cases_week1.md)

## 運用方針
1. このチケットを親として、テスト中に発見された問題をBugfix/Backlogチケットとして作成
2. テストケース自体に問題がある場合も、このチケットに関連付けて管理
3. テスト実施状況は、このチケットのコメントで随時更新

## 完了条件
- Week1のすべてのE2Eテストケースが実施完了
- 発見されたすべての不具合がチケット化され、対応状況が明確
- テストケースの問題が全て洗い出され、改善案が提示されている

## 注意事項
- このチケットは、Week1の実装進捗とは独立した品質確認のチケットです
- マイルストーンには紐付けず、独立して管理します
```

### 2. テスト環境のセットアップ

#### 前提条件の確認

- [ ] バックエンドサーバーが起動している（`http://localhost:8000`）
- [ ] フロントエンドサーバーが起動している（`http://localhost:3000`）
- [ ] データベースに初期データが投入されている

#### 初期データの投入

```bash
# バックエンドディレクトリで実行
cd backend

# ジャンルマスターデータ投入
python3 scripts/init_genres.py

# ユーザーデータ投入
python3 scripts/init_users.py

# ドキュメントデータ投入
python3 scripts/init_documents.py
```

---

## テスト実施手順

### 1. テストケースドキュメントの確認

対応するWeekのE2Eテストケースドキュメントを確認します。

- Week1: `docs/testing/e2e_test_cases_week1.md`
- Week2: `docs/testing/e2e_test_cases_week2.md`

### 2. テストケースの実行

テストケースドキュメントに記載されている各テストケースを順番に実施します。

#### テスト実施時のチェック項目

- [ ] 期待される動作が正しく実装されているか
- [ ] エラーハンドリングが適切に実装されているか
- [ ] UI/UXが想定どおりに動作しているか
- [ ] パフォーマンスに問題がないか

### 3. テスト結果の記録

各テストケースの結果を記録します。

- ✅ **Pass**: 期待どおりに動作した
- ❌ **Fail**: 期待どおりに動作しなかった（不具合を発見）
- ⚠️ **Skip**: 前提条件が満たされずスキップした
- 📝 **Note**: テストケース自体に問題がある（改善提案）

---

## 問題発見時の対応

### 1. 不具合を発見した場合

#### 1.1. Bugfixチケットの作成

1. GitHubでIssueを作成
   - タイトル: `[Bugfix] 問題の概要`
   - ラベル: `bug`、関連する技術領域（`frontend`、`backend`など）
   - 優先度: 問題の重要度に応じて設定

2. チケット本文に以下を記載
   - **問題**: 発見した問題の概要
   - **発見経緯**: E2Eテスト実施中に発見したことを明記
   - **期待される動作**: 正しい動作の説明
   - **再現手順**: 問題を再現する手順
   - **影響範囲**: 問題による影響
   - **優先度**: High/Medium/Low
   - **関連Issue**: E2Eテストマスターチケットへの参照

#### 1.2. E2Eテストマスターチケットとの関連付け

1. E2Eテストマスターチケットにコメントを追加
   - 発見された不具合の一覧に新しいBugfixチケットを追加
   - テンプレート:
     ```markdown
     ## 関連チケット一覧
     
     ### 発見された不具合
     - #XX [Bugfix] 問題の概要
     ```

2. Bugfixチケットにもコメントを追加
   - 親Issue: #XX（E2Eテストマスターチケット）に関連付けていることを明記

### 2. テストケース自体に問題がある場合

#### 2.1. Backlogチケットの作成

1. GitHubでIssueを作成
   - タイトル: `[Backlog] テストケース改善: 改善内容の概要`
   - ラベル: `backlog`、`testing`
   - タイプ: 改善提案

2. チケット本文に以下を記載
   - **問題**: テストケースの問題点
   - **改善提案**: どのように改善すべきか
   - **理由**: なぜ改善が必要か
   - **関連Issue**: E2Eテストマスターチケットへの参照

#### 2.2. E2Eテストマスターチケットとの関連付け

E2Eテストマスターチケットにコメントを追加して、テストケースの問題を追跡します。

```markdown
## 関連チケット一覧

### テストケースの問題
- #XX [Backlog] テストケース改善: 改善内容の概要
```

---

## テスト完了時の作業

### 1. テスト結果のまとめ

E2Eテストマスターチケットにコメントを追加して、テスト実施結果をまとめます。

```markdown
## テスト実施結果サマリー

### 実施日
2026-01-XX

### テストケース実行結果
- 総テストケース数: XX件
- Pass: XX件
- Fail: XX件
- Skip: XX件

### 発見された不具合
- #XX [Bugfix] 問題1
- #XX [Bugfix] 問題2

### テストケースの問題
- #XX [Backlog] テストケース改善: 改善内容1

### 所感・備考
（テスト実施を通じて感じたこと、改善提案など）
```

### 2. 完了条件の確認

以下の条件を満たしているか確認します。

- [ ] すべてのE2Eテストケースが実施完了
- [ ] 発見されたすべての不具合がチケット化されている
- [ ] 不具合の対応状況が明確になっている
- [ ] テストケースの問題が全て洗い出されている
- [ ] テスト結果サマリーが記録されている

### 3. チケットのクローズ

E2Eテストマスターチケットは、以下の条件を満たした場合にクローズします。

- すべてのテストケースが実施完了
- 発見された不具合がすべて対応済み、または次のSprintで対応予定として整理済み
- テストケースの問題がすべて改善済み、または次回テストで反映予定として整理済み

---

## チケット管理のベストプラクティス

### 1. 一貫した命名規則

- Bugfix: `[Bugfix] 問題の概要`
- Backlog: `[Backlog] 改善内容の概要`

### 2. 優先度の付け方

- **High**: 主要機能が使えない、データ損失のリスクがある
- **Medium**: 機能は動作するが、UXに大きな影響がある
- **Low**: 小さな問題、改善の余地がある

### 3. 関連付けの明確化

- E2Eテストマスターチケットを常に親として参照
- コメントで双方向に関連付けを明記

### 4. 定期的な見直し

- テスト実施後に、発見された問題をレビュー
- 優先度の再評価
- 対応方針の決定

---

## よくある質問（FAQ）

### Q1: E2Eテストマスターチケットはマイルストーンに紐付けるべきですか？

**A:** いいえ。E2Eテストマスターチケットは実装進捗とは独立した品質確認のチケットのため、マイルストーンには紐付けません。独立して管理します。

### Q2: テスト実施中に発見された不具合は、すぐに修正すべきですか？

**A:** 優先度に応じて判断します。High優先度の不具合は即座に対応し、Low優先度の不具合は次のSprintで対応するなど、チームで方針を決定します。

### Q3: テストケースが実装と一致していない場合、どちらを優先しますか？

**A:** 実装の方が正しい場合は、テストケースを更新するBacklogチケットを作成します。テストケースの方が正しい場合は、実装の不具合としてBugfixチケットを作成します。

---

## 参考リンク

- [GitHubワークフロー](./github_workflow.md)
- [E2Eテストケース（Week1）](../testing/e2e_test_cases_week1.md)
- [E2Eテストケース（Week2）](../testing/e2e_test_cases_week2.md)

