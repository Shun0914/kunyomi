# Week 2 タスク分割案

## Week 2の目標

**リリース2の差別化機能を実装**
- 評価機能（役立ち度）：ドキュメントに対する評価機能とスコア算出
- ナレッジ間の関係可視化：キーワード類似度によるグラフ可視化

**完了の定義**:
- バックエンドAPIが動作（ローカル環境）
- フロントエンドからAPI呼び出し成功
- 可視化機能が動作する
- エラーハンドリングが最低限ある

---

## フェーズ3: 評価機能（役立ち度）

### 3-1. DocumentEvaluationテーブルの作成
**所要時間**: 30分-1時間  
**担当**: @Shun0914  
**依存**: Week1完了後  
**内容**:
- `DocumentEvaluation`モデルの定義（`docs/design/data_definition.md`に基づく）
- Alembicマイグレーションの作成
- マイグレーションの実行

**完了条件**:
- `DocumentEvaluation`テーブルがDBに作成されている
- モデルが正しく定義されている（User, Documentとのリレーション）

---

### 3-2. 評価APIの実装（バックエンド）
**所要時間**: 1-2時間  
**担当**: @Ogura-Naomi  
**依存**: 3-1完了後  
**内容**:
- `POST /api/documents/{document_id}/evaluate`エンドポイントの実装
  - リクエスト: `{ "is_helpful": true/false }`
  - レスポンス: 評価後のドキュメント情報
- バリデーション（1ユーザー1ドキュメントにつき1回まで）
- `DocumentEvaluation`レコードの作成
- `Document.helpful_count`と`Document.helpfulness_score`の更新

**完了条件**:
- APIエンドポイントが動作する
- 評価が正しく記録される
- スコアが正しく更新される
- 重複評価が防げる

**参考**:
- `docs/design/data_definition.md`の`DocumentEvaluation`テーブル定義
- `helpfulness_score`の算出式: `helpful_count / MAX(view_count, 1)`

---

### 3-3. 評価UIの実装（フロントエンド）
**所要時間**: 1-2時間  
**担当**: @Ogura-Naomi  
**依存**: 3-2完了後  
**内容**:
- ドキュメント詳細画面に評価ボタンを追加
  - 「役立った」ボタン（👍）
  - 「そうでもない」ボタン（👎）
- 評価状態の表示（既に評価済みかどうか）
- API呼び出しの実装
- 評価後のスコア更新表示

**完了条件**:
- 評価ボタンが表示される
- 評価が正しく送信される
- 評価後の状態が正しく更新される

**参考**:
- `frontend_figma/src/app/components/KnowledgeDetail.tsx`を参考に

---

## フェーズ4: ナレッジ間の関係可視化

### 4-1. キーワード類似度APIの実装（バックエンド）
**所要時間**: 1-2時間  
**担当**: @misakikuboshima  
**依存**: Week1完了後  
**内容**:
- `GET /api/documents/{document_id}/related`エンドポイントの実装
  - キーワード類似度による関連ドキュメント取得
  - 共通キーワード数を計算
  - 関連度の高いドキュメントを返す
- レスポンス: 関連ドキュメント一覧（共通キーワード数、スコア含む）

**完了条件**:
- APIエンドポイントが動作する
- キーワード類似度が正しく計算される
- 関連度順でソートされる

**参考**:
- `docs/design/data_definition.md`の「関連ドキュメント（キーワード類似度）」SQLクエリ

---

### 4-2. 関係可視化コンポーネントの実装（フロントエンド）
**所要時間**: 2-3時間  
**担当**: @misakikuboshima  
**依存**: 4-1完了後  
**内容**:
- `KnowledgeNetwork`コンポーネントのNext.js版実装
  - `'use client'`ディレクティブを追加
  - `react-force-graph-2d`を使用
  - ノード: ドキュメント（タイトル、スコアに応じた色）
  - リンク: キーワード類似度（共通キーワード数が1以上）
- グラフ操作機能（ズーム、フィット）
- ノードクリックで詳細画面へ遷移

**完了条件**:
- グラフが正しく表示される
- ノードとリンクが正しく可視化される
- インタラクション（クリック、ズーム）が動作する

**参考**:
- `frontend_figma/src/app/components/KnowledgeNetwork.tsx`
- 依存関係: `react-force-graph-2d`をインストール必要

---

## フェーズ5: 次優先機能（時間があれば）

### 5-1. Q&A機能の実装
**所要時間**: 3-4時間  
**担当**: @Yoko-dev  
**依存**: Week1完了後  
**内容**:
- QAテーブルの作成（Alembicマイグレーション）
- Q&A投稿APIの実装
- Q&A表示UIの実装
- FAQ化機能

**完了条件**:
- Q&Aが投稿できる
- Q&Aが表示される
- FAQ化ができる

**注意**: 時間が足りない場合はWeek3に持ち越し

---

### 5-2. 通知機能の実装
**所要時間**: 2-3時間  
**担当**: @Yoko-dev  
**依存**: 5-1完了後（Q&A通知の場合）  
**内容**:
- 通知テーブルの作成（必要に応じて）
- 通知APIの実装
- 通知UIの実装
- メール/Teams/Slack連携（基本実装）

**完了条件**:
- 通知が送信できる
- 通知が表示される

**注意**: 時間が足りない場合はWeek3に持ち越し

---

## デプロイタスク

### D-1. Azure環境へのデプロイ
**所要時間**: 2-3時間  
**担当**: @しゅんすけ  
**依存**: Week2完了後（または並行作業可）  
**内容**:
- Azure App Serviceの設定
- Azure Database for MySQLの設定
- 環境変数の設定
- デプロイスクリプトの作成
- データベースマイグレーションの実行
- 動作確認

**完了条件**:
- 本番環境でアプリケーションが動作する
- データベース接続が正常に動作する
- 基本的な機能が動作する

---

## タスクの並行可能性

### 並行可能なタスク
- **フェーズ3とフェーズ4**: 独立しているため並行可能
  - 3-1, 3-2, 3-3（評価機能）: @Shun0914, @Ogura-Naomi
  - 4-1, 4-2（関係可視化）: @misakikuboshima

- **フェーズ5**: 時間があれば並行作業可
  - 5-1（Q&A）: @Yoko-dev
  - 5-2（通知）: @Yoko-dev

- **デプロイタスク**: 並行作業可（ただし、本番環境の準備が整った後）

### 依存関係に注意
- フェーズ3: 3-1 → 3-2 → 3-3の順
- フェーズ4: 4-1 → 4-2の順
- フェーズ5: 5-1 → 5-2の順（Q&A通知の場合）

---

## 週次サイクルの進め方

### 月曜: Week1振り返り + Week2プランニング
- Week1の成果を確認
- Week2の目標を決定
- 担当を決める（コンフリクト回避を確認）
- E2Eテスト実施（Week2開始時）

### 月曜-水曜: 開発
- 各担当がIssueに取り組む
- 小さなPRを頻繁に出す
- 詰まったらSlackで質問

### 木曜: 振り返り + Week3計画
- Week2の成果を確認
- Week3の計画を立てる
- デモ（できたものを見せる）

---

## リスクと対策

### リスク1: グラフ可視化ライブラリの学習コスト
**対策**: `KnowledgeNetwork.tsx`の既存コードを参考に、`'use client'`を追加するだけの簡単な変更から始める。

### リスク2: キーワード類似度計算のパフォーマンス
**対策**: SQLクエリで効率的に計算する（`docs/design/data_definition.md`のクエリを参考）。必要に応じてインデックスを追加。

### リスク3: 時間が足りない
**対策**: 最優先（評価機能、関係可視化）に集中。Q&Aと通知はWeek3に持ち越してもOK。

### リスク4: デプロイの遅延
**対策**: デプロイタスクは並行作業可能。ただし、本番環境の準備が整った後に実施。

---

## 優先順位（時間が足りない場合）

### 最優先（Week 2で必須）
1. 3-1（DocumentEvaluationテーブル作成）
2. 3-2（評価API実装）
3. 3-3（評価UI実装）
4. 4-1（キーワード類似度API実装）
5. 4-2（関係可視化コンポーネント実装）
6. D-1（Azureデプロイ）

### 次優先（Week 2で実装したい）
7. 5-1（Q&A機能）

### できれば（Week 3に持ち越してもOK）
8. 5-2（通知機能）

---

## 次のステップ

1. このタスク分割案をチームで確認
2. 担当者を決定
3. GitHubでIssueを作成
4. 開発開始（Week2初日から）

