# Week 1 タスク分割案

## Week 1の目標

**MVP機能を「完璧に動く」状態まで実装**
- 検索：キーワード検索、一覧/詳細表示
- 記録/登録：ナレッジの新規作成・登録（フォーム形式）

**完了の定義**:
- バックエンドAPIが動作（ローカル環境）
- フロントエンドからAPI呼び出し成功
- CRUDが一通り動作
- エラーハンドリングが最低限ある

---

## フェーズ0: 基盤整備（@しゅんすけが主導）

### 0-1. バックエンドプロジェクト作成
**所要時間**: 30分-1時間  
**担当**: @しゅんすけ  
**内容**:
- FastAPIプロジェクト構造の作成
- `requirements.txt`の作成（FastAPI, SQLAlchemy, pymysql等）
- 基本的なディレクトリ構造の設定

**完了条件**:
- `backend/app/main.py`が存在し、起動できる
- `backend/requirements.txt`に必要な依存関係が記載されている

---

### 0-2. データベース接続設定
**所要時間**: 30分-1時間  
**担当**: @しゅんすけ  
**依存**: 0-1完了後  
**内容**:
- データベース接続設定（SQLAlchemy）
- 環境変数の設定（`.env`ファイル）
- 接続テスト

**完了条件**:
- ローカルDB（MySQL）に接続できる
- 環境変数で接続情報を管理できる

---

### 0-3. DBモデル定義（全テーブル）
**所要時間**: 1-2時間  
**担当**: @しゅんすけ  
**依存**: 0-2完了後  
**内容**:
- SQLAlchemyモデルの定義（data_definition.mdに基づく）
  - User
  - Genre
  - Keyword
  - Document
  - DocumentKeyword
- リレーションシップの定義
- Alembicの初期化（マイグレーション環境）

**完了条件**:
- 全テーブルのモデルが定義されている
- マイグレーションが実行できる

---

### 0-4. 初期データ投入（ジャンルマスター）
**所要時間**: 30分  
**担当**: @しゅんすけ  
**依存**: 0-3完了後  
**内容**:
- ジャンルマスターデータの作成（初期データ）
- データ投入スクリプトの作成

**完了条件**:
- ジャンルマスターデータがDBに投入されている

---

### 0-5. APIクライアント関数の作成（フロントエンド）
**所要時間**: 1時間  
**担当**: @しゅんすけ or 経験者  
**依存**: 0-3完了後（並行可能）  
**内容**:
- `frontend/src/api/`ディレクトリの作成
- APIクライアント関数の作成（型定義含む）
  - `documents.ts`（GET一覧、GET詳細、POST作成）
  - `genres.ts`（GET一覧）
  - `keywords.ts`（GET一覧、検索）
- エラーハンドリング用ユーティリティ

**完了条件**:
- API呼び出し関数が定義されている（型安全）
- エラーハンドリングが実装されている

---

## フェーズ1: バックエンドAPI実装

### 1-1. ジャンル一覧取得API
**所要時間**: 30分-1時間  
**担当**: メンバーA  
**依存**: 0-3完了後  
**内容**:
- `GET /api/genres` エンドポイント実装
- 階層構造を考慮したレスポンス（親子関係を含む）
- ステータスコードとエラーハンドリング

**完了条件**:
- APIが動作し、ジャンル一覧が取得できる
- 階層構造が正しく返される

---

### 1-2. ドキュメント一覧取得API
**所要時間**: 1時間  
**担当**: メンバーB  
**依存**: 0-3完了後  
**内容**:
- `GET /api/documents` エンドポイント実装
- クエリパラメータ対応（ジャンルフィルタ、ステータスフィルタ）
- ページネーション対応（必要に応じて）
- レスポンスにジャンル名、作成者名を含める

**完了条件**:
- APIが動作し、ドキュメント一覧が取得できる
- フィルタリングが動作する

---

### 1-3. ドキュメント詳細取得API
**所要時間**: 30分-1時間  
**担当**: メンバーC  
**依存**: 0-3完了後  
**内容**:
- `GET /api/documents/{id}` エンドポイント実装
- レスポンスにキーワード一覧を含める
- 閲覧数のインクリメント処理
- 存在しないIDの場合のエラーハンドリング

**完了条件**:
- APIが動作し、ドキュメント詳細が取得できる
- 閲覧数が正しくインクリメントされる

---

### 1-4. ドキュメント作成API
**所要時間**: 1-2時間  
**担当**: メンバーA or メンバーB  
**依存**: 0-3完了後  
**内容**:
- `POST /api/documents` エンドポイント実装
- リクエストバリデーション（Pydanticスキーマ）
- キーワードの処理（既存キーワードの紐付け、新規キーワードの作成）
- キーワード数制限のバリデーション（最大3個）
- トランザクション処理

**完了条件**:
- APIが動作し、ドキュメントが作成できる
- キーワードが正しく紐付けられる
- バリデーションが動作する（3個制限）

---

### 1-5. キーワード検索API
**所要時間**: 1時間  
**担当**: メンバーC  
**依存**: 0-3完了後  
**内容**:
- `GET /api/keywords` エンドポイント実装（一覧取得）
- `GET /api/keywords/search?q={query}` エンドポイント実装（検索）
- 正規化処理（NFKC Normalize、ケースフォールディング）
- 使用回数順でのソート

**完了条件**:
- APIが動作し、キーワード一覧・検索ができる
- 正規化処理が正しく動作する

---

### 1-6. ドキュメント検索API
**所要時間**: 1-2時間  
**担当**: メンバーA or メンバーB  
**依存**: 1-2, 1-5完了後  
**内容**:
- `GET /api/documents/search?q={keyword}` エンドポイント実装
- タイトル検索（LIKE検索）
- キーワード検索（正規化名でのマッチング）
- 検索結果のソート（helpfulness_score DESC, updated_at DESC）

**完了条件**:
- APIが動作し、検索ができる
- タイトルとキーワードの両方で検索できる
- ソートが正しく動作する

---

## フェーズ2: フロントエンド接続

### 2-1. 一覧画面のAPI接続
**所要時間**: 1-2時間  
**担当**: メンバーA  
**依存**: 0-5, 1-2完了後  
**内容**:
- `KnowledgeList`コンポーネントの修正
- モックデータからAPI呼び出しに変更
- ローディング状態の追加
- エラー表示の追加

**完了条件**:
- 一覧画面がAPIからデータを取得して表示できる
- ローディング・エラー状態が適切に表示される

---

### 2-2. ジャンルセレクターのAPI接続
**所要時間**: 1時間  
**担当**: メンバーB  
**依存**: 0-5, 1-1完了後  
**内容**:
- `GenreSelector`コンポーネントの修正
- モックデータからAPI呼び出しに変更
- 階層構造の表示

**完了条件**:
- ジャンルセレクターがAPIからデータを取得して表示できる
- 階層構造が正しく表示される

---

### 2-3. 検索機能の実装
**所要時間**: 1-2時間  
**担当**: メンバーC  
**依存**: 0-5, 1-6完了後  
**内容**:
- `SearchBar`コンポーネントの修正
- 検索APIの呼び出し
- 検索結果の表示
- デバウンス処理（必要に応じて）

**完了条件**:
- 検索が動作し、結果が表示される
- タイトルとキーワードの両方で検索できる

---

### 2-4. 詳細画面のAPI接続
**所要時間**: 1-2時間  
**担当**: メンバーA  
**依存**: 0-5, 1-3完了後  
**内容**:
- `KnowledgeDetail`コンポーネントの修正
- モックデータからAPI呼び出しに変更
- ローディング状態の追加
- エラー表示の追加
- 閲覧数の更新処理

**完了条件**:
- 詳細画面がAPIからデータを取得して表示できる
- 閲覧数が正しく更新される

---

### 2-5. 作成画面のAPI接続
**所要時間**: 1-2時間  
**担当**: メンバーB  
**依存**: 0-5, 1-4, 1-1, 1-5完了後  
**内容**:
- `KnowledgeForm`コンポーネントの修正
- モックデータからAPI呼び出しに変更
- フォームバリデーション（フロントエンド側）
- キーワード3個制限のUI実装
- 送信後のリダイレクト処理

**完了条件**:
- 作成画面が動作し、ドキュメントを作成できる
- バリデーションが動作する（キーワード3個制限含む）
- 作成後に一覧画面にリダイレクトされる

---

### 2-6. エラーハンドリングの統一
**所要時間**: 1時間  
**担当**: @しゅんすけ or 経験者  
**依存**: 2-1〜2-5完了後  
**内容**:
- エラーハンドリングの統一
- エラーメッセージの表示改善
- ネットワークエラーの処理

**完了条件**:
- エラーハンドリングが統一されている
- ユーザーフレンドリーなエラーメッセージが表示される

---

## 並行作業の可能性

### 並行可能なタスク
- **フェーズ1の各APIエンドポイント**: 担当を分ければ並行可能
  - 1-1（ジャンル）: メンバーA
  - 1-2（一覧）: メンバーB
  - 1-3（詳細）: メンバーC
  - 1-4（作成）: メンバーA or B
  - 1-5（キーワード）: メンバーC
  - 1-6（検索）: メンバーA or B

- **フェーズ2の各画面**: 担当を分ければ並行可能
  - 2-1（一覧）: メンバーA
  - 2-2（ジャンル）: メンバーB
  - 2-3（検索）: メンバーC
  - 2-4（詳細）: メンバーA
  - 2-5（作成）: メンバーB

### 依存関係に注意
- フェーズ2はフェーズ1の完了を待つ必要がある
- ただし、モックデータで動作確認できる部分は先に進められる

---

## 週次サイクルの進め方

### 木曜: プランニング
- その週の目標を決定（3-5個のIssue）
- 担当を決める（コンフリクト回避を確認）
- 依存関係を確認

### 木曜-火曜: 開発
- 各担当がIssueに取り組む
- 小さなPRを頻繁に出す
- 詰まったらSlackで質問

### 水曜: 振り返り + 完了確認
- その週の成果を確認
- 次週の計画を立てる
- デモ（できたものを見せる）

---

## リスクと対策

### リスク1: バックエンドの実装が遅れる
**対策**: フェーズ0は@しゅんすけが早めに完了させる。フェーズ1は並行作業で進める。

### リスク2: API仕様の不一致
**対策**: 0-5でAPIクライアント関数を作成する際に、型定義で仕様を明確化する。

### リスク3: データベース接続の問題
**対策**: 0-2で早めに接続確認を行い、問題があれば早期に解決する。

### リスク4: 時間が足りない
**対策**: Week 1で完璧に動かなくても、Week 2に持ち越す。優先順位をつける。

---

## 優先順位（時間が足りない場合）

### 最優先（Week 1で必須）
1. フェーズ0（基盤整備）
2. 1-1（ジャンル取得）
3. 1-2（一覧取得）
4. 1-3（詳細取得）
5. 2-1（一覧画面接続）
6. 2-4（詳細画面接続）

### 次優先（Week 1で実装したい）
7. 1-4（作成API）
8. 2-5（作成画面接続）

### できれば（Week 2に持ち越してもOK）
9. 1-5（キーワード検索）
10. 1-6（ドキュメント検索）
11. 2-3（検索機能）
12. 2-2（ジャンルセレクター）

---

## 次のステップ

1. このタスク分割案をチームで確認
2. 担当者を決定
3. GitHubでIssueを作成
4. 開発開始（1/8から）

