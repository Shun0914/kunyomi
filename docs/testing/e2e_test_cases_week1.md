# Week 1 E2Eテストケース

## 概要

Week 1で実装した機能に対するE2E（End-to-End）テストケースです。
実際のユーザー操作フローに沿ったテストシナリオを定義しています。

## テスト環境

- **フロントエンド**: http://localhost:3000
- **バックエンド**: http://localhost:8000
- **データベース**: ローカルMySQL（初期データ投入済み）

## テストデータの準備

### 前提条件

1. バックエンドサーバーが起動している
2. フロントエンドサーバーが起動している
3. データベースに初期データが投入されている
   - ジャンルマスターデータ
   - ユーザーデータ（テスト用）
   - ドキュメントデータ（テスト用）

### 初期データ投入スクリプト

```bash
# バックエンドディレクトリで実行
cd backend

# ジャンルマスターデータ投入
python3 scripts/init_genres.py

# ユーザーデータ投入
python3 scripts/init_users.py

# ドキュメントデータ投入
python3 scripts/init_documents.py
```

---

## テストケース

### TC-001: ジャンル一覧取得（階層構造）

**目的**: ジャンル一覧が階層構造で正しく取得できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ジャンルマスターデータが投入されている

**手順**:
1. ブラウザで http://localhost:3000 にアクセス
2. サイドバーのジャンルセクションを確認

**期待結果**:
- ジャンルが階層構造で表示される
- 親ジャンル（L1）→ 子ジャンル（L2）→ 孫ジャンル（L3）の順に表示される
- 各ジャンルがクリック可能

---

### TC-002: ドキュメント一覧取得

**目的**: ドキュメント一覧が正しく取得できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ドキュメントデータが投入されている

**手順**:
1. ブラウザで http://localhost:3000/document-list にアクセス
2. ドキュメント一覧が表示されるのを待つ

**期待結果**:
- ドキュメント一覧が表示される
- 各ドキュメントに以下の情報が表示される：
  - タイトル
  - ジャンル名
  - 作成者名
  - 作成日時
  - 閲覧数
  - 役立ち度スコア
- ローディング状態が適切に表示される

---

### TC-003: ジャンルフィルタによるドキュメント一覧取得

**目的**: ジャンルでフィルタしたドキュメント一覧が正しく取得できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ドキュメントデータが投入されている

**手順**:
1. ブラウザで http://localhost:3000/document-list にアクセス
2. サイドバーからジャンルを選択（例: 「開発系 > API開発」）
3. フィルタされたドキュメント一覧を確認

**期待結果**:
- 選択したジャンルのドキュメントのみが表示される
- 他のジャンルのドキュメントは表示されない
- 「すべて」を選択すると全ドキュメントが表示される

---

### TC-004: キーワード検索によるドキュメント一覧取得

**目的**: キーワード検索でドキュメント一覧が正しく取得できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ドキュメントデータが投入されている（キーワードが設定されている）

**手順**:
1. ブラウザで http://localhost:3000/document-list にアクセス
2. 検索バーにキーワードを入力（例: 「API」）
3. 検索結果を確認

**期待結果**:
- 入力したキーワードを含むドキュメントが表示される
- タイトルまたはキーワードでマッチするドキュメントが表示される
- 検索結果がない場合は適切なメッセージが表示される

---

### TC-005: ドキュメント詳細取得

**目的**: ドキュメント詳細が正しく取得できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ドキュメントデータが投入されている

**手順**:
1. ブラウザで http://localhost:3000/document-list にアクセス
2. ドキュメント一覧から任意のドキュメントをクリック
3. ドキュメント詳細画面を確認

**期待結果**:
- ドキュメント詳細が表示される
- 以下の情報が表示される：
  - タイトル
  - 本文（コンテンツ）
  - ジャンル名
  - 作成者名
  - 作成日時
  - 更新日時
  - 閲覧数（アクセス時に+1されている）
  - 役立ち度スコア
  - キーワード一覧
- 外部リンクがある場合はリンクが表示される

---

### TC-006: ドキュメント作成（正常系）

**目的**: ドキュメントが正しく作成できることを確認

**前提条件**:
- バックエンドサーバーが起動している
- ジャンルマスターデータが投入されている

**手順**:
1. ブラウザで http://localhost:3000/document-create（または作成画面URL）にアクセス
2. 以下の情報を入力：
   - タイトル: 「テストドキュメント」
   - 本文: 「これはテスト用のドキュメントです」
   - ジャンル: 「開発系 > API開発」（レベル3を選択）
   - キーワード: 「テスト」「API」（最大3個まで）
   - 外部リンク: （任意）
3. 「作成」ボタンをクリック
4. 作成結果を確認

**期待結果**:
- ドキュメントが正常に作成される
- 作成されたドキュメントの詳細画面にリダイレクトされる
- 入力した情報が正しく反映されている
- キーワードが正しく紐付けられている
- ステータスが「published」になっている

---

### TC-007: ドキュメント作成（バリデーションエラー）

**目的**: ドキュメント作成時のバリデーションが正しく動作することを確認

**前提条件**:
- バックエンドサーバーが起動している

**手順**:

#### TC-007-1: 必須項目の空文字

1. ブラウザで http://localhost:3000/document-create にアクセス
2. タイトルを空のまま「作成」ボタンをクリック

**期待結果**:
- バリデーションエラーメッセージが表示される
- 「タイトルは必須項目です」などのエラーメッセージ

#### TC-007-2: キーワード数制限

1. ブラウザで http://localhost:3000/document-create にアクセス
2. キーワードを4個以上入力（例: 「キーワード1」「キーワード2」「キーワード3」「キーワード4」）
3. 「作成」ボタンをクリック

**期待結果**:
- バリデーションエラーメッセージが表示される
- 「キーワードは最大3個までです」などのエラーメッセージ

#### TC-007-3: 存在しないジャンルID

1. ブラウザで http://localhost:3000/document-create にアクセス
2. 存在しないジャンルIDを指定（開発者ツールで設定）
3. 「作成」ボタンをクリック

**期待結果**:
- バリデーションエラーメッセージが表示される
- 「ジャンルが見つかりません」などのエラーメッセージ

---

### TC-008: エラーハンドリング（APIエラー）

**目的**: APIエラーが適切にハンドリングされることを確認

**前提条件**:
- バックエンドサーバーが起動していない、またはエラー状態

**手順**:
1. バックエンドサーバーを停止
2. ブラウザで http://localhost:3000/document-list にアクセス

**期待結果**:
- エラーメッセージが表示される
- 「データの取得に失敗しました」などのユーザーフレンドリーなメッセージ
- 再読み込みボタンが表示される（オプション）

---

## テスト実行手順

### 1. 環境セットアップ

```bash
# バックエンドディレクトリで実行
cd backend
source venv/bin/activate
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# フロントエンドディレクトリで実行（別ターミナル）
cd frontend
npm run dev
```

### 2. テストデータの投入

```bash
# バックエンドディレクトリで実行
cd backend
source venv/bin/activate

# 初期データ投入
python3 scripts/init_genres.py
python3 scripts/init_users.py
python3 scripts/init_documents.py
```

### 3. テスト実行

各テストケース（TC-001〜TC-008）を順番に実行し、期待結果と比較します。

### 4. テスト結果の記録

- ✅ パス: 期待結果通りに動作した
- ❌ 失敗: 期待結果と異なる動作があった
- ⚠️ 保留: 実装未完了などでテストできない

---

## 注意事項

- E2Eテストは実際のブラウザで実行するため、時間がかかることがあります
- テストデータは毎回同じ状態にリセットすることを推奨します
- テスト実行前に、ブラウザのキャッシュをクリアすることを推奨します
- テストケースは実装状況に応じて更新してください

